<%- include('../partials/header', { title: 'Submit Feedback', page: 'feedback' }) %>

<section class="section" style="height: 100vh;">
    <div class="container" style="max-width: 600px;">
        <h1 class="section-title" style="text-align:center;">Submit Campaign Feedback</h1>
        <form id="feedbackForm" method="POST" action="/api/feedback" class="form-card">
            <div class="form-group">
                <label for="name">Name (optional)</label>
                <input type="text" id="name" name="name" class="form-control" placeholder="Your name">
            </div>
            <div class="form-group">
                <label for="email">Email (optional)</label>
                <input type="email" id="email" name="email" class="form-control" placeholder="Your email">
            </div>
            <div class="form-group">
                <label for="message">Feedback</label>
                <textarea id="message" name="message" class="form-control" rows="5" required placeholder="Your feedback..."></textarea>
            </div>
            <button type="submit" class="btn-primary btn-large" style="width:100%;margin-top:16px;">Submit Feedback</button>
        </form>
        <div id="feedbackAlert" style="margin-top:20px;"></div>
    </div>

    <% if (typeof feedbackList !== 'undefined' && feedbackList.length > 0) { %>
    <div class="feedback-list">
        <h2 class="section-title">Recent Feedback</h2>
        <% feedbackList.forEach(function(feedback) { %>
            <div class="feedback-item">
                <div class="feedback-meta">
                    <span><%= feedback.name ? feedback.name : 'Anonymous' %></span>
                    <span class="feedback-date"><%= feedback.createdAt.toLocaleString() %></span>
                </div>
                <div class="feedback-message">
                    <%= feedback.message %>
                </div>
            </div>
        <% }); %>
    </div>
<% } %>
</section>

<script>
    document.getElementById('feedbackForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const form = e.target;
        const alertBox = document.getElementById('feedbackAlert');
        alertBox.innerHTML = '';
        const formData = {
            name: form.name.value,
            email: form.email.value,
            message: form.message.value
        };
        try {
            const res = await fetch('/api/feedback', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });
            const data = await res.json();
            if (res.ok) {
                alertBox.innerHTML = '<div class="alert alert-success">Thank you for your feedback!</div>';
                form.reset();
                window.location.reload();
            } else {
                alertBox.innerHTML = `<div class="alert alert-error">${data.message || 'Error submitting feedback.'}</div>`;
            }
        } catch (err) {
            alertBox.innerHTML = '<div class="alert alert-error">Error submitting feedback.</div>';
        }
    });
</script>

<%- include('../partials/footer', { scripts: null }) %>

